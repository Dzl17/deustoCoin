{% extends "base.html" %}
{% block head %}
<style>
  .button-grid {
    display: grid;
    gap: 2px;
    grid-template-columns: repeat(2, 1fr);
  }

  @media (orientation:portrait) and (max-width: 768px) {
    #acciones {
      table-layout: auto;
      width: 100%;
    }

    .showDetails {
      display: block;
    }

    .emp {
      display: none;
    }

    .ind {
      display: none;
    }

    .est {
      display: none;
    }

    .obj {
      display: none;
    }

    .button-grid {
      grid-template-columns: repeat(1, 1fr);
    }
  }

  @media (orientation:landscape) {
    .showDetails {
      display: none;
    }
  }

  @media (orientation:landscape) and (min-width: 1024px) {
    .showDetails {
      display: none;
    }
  }
</style>
{% endblock %}
{% block body %}
<div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pb-2 mb-3 border-bottom">
  <h1 class="h2">{{gettext('Menú principal')}}</h1>
</div>
<div class="view">
  <div class="bg-light card px-5 py-5 mb-5">
    <h2>{{ gettext('Hola') }}, {{ name }}.</h2>
    <h2>
      <span style="font-size: 1rem">{{ gettext('Bienvenido al menú principal.' )}}</span>
    </h2>
    <h2>
      <span style="font-size: 1rem">{{ gettext ('El saldo actual de la universidad es de') }} <b>{{ wallet }}</b>
        UDC.</span><br />
      {% if user.blockAddr is not none %}
      <p style="font-size:11px;text-align:left;">{{gettext('Tu dirección de Blockchain es')}} {{user.block_addr}}.</p>
      {% endif %}
    </h2>
    <div class="button-grid">
      <button class="btn btn-primary btn-large" id="mostrarformacc" style="text-align: center; font-size:70%;">{{
        gettext('Crear acción') }}</button>
      <button class="btn btn-primary btn-large" id="mostraracc"
        style="text-align: center;  font-size:70%;">{{gettext('Mostrar acciones')}}</button>
      <button class="btn btn-primary btn-large" id="mostrarformcamp" style="text-align: center;  font-size:70%;">{{
        gettext('Crear campaña') }}</button>
      <button class="btn btn-primary btn-large" id="mostrarcamp" style="text-align: center;  font-size:70%;">{{
        gettext('Mostrar campañas') }}</button>
      <button class="btn btn-primary btn-large" id="crearofertas" style="text-align: center;  font-size:70%;">{{
        gettext('Crear oferta')}}</button>
      <button class="btn btn-primary btn-large" id="mostrarofertas" style="text-align: center;  font-size:70%;">{{
        gettext('Mostrar ofertas') }}</button>
    </div>
  </div>
  <form style="display: none;" id="create-campaign-form" method="POST">
    {{ form.csrf_token }}
    <div class="form-group">
      <p>
        <label for="exampleInputEmail1">{{ gettext('Nombre de la campaña') }}</label>

        <br />
        {{form.campaign_name(class="form-control")}}
      </p>
    </div>
    {% if user.role == "Administrador" %}
    <div class="form-group">
      {{ gettext('Empresa') }}
      <br />
      {{form.company(class="form-control")}}
    </div>
    {% endif %}
    <div class="form-group">
      {{gettext('Descripción')}}
      <br />
      {{form.description(class="form-control")}}
    </div>
    <p>
      <input type="button" name="create_campaign" value="Create campaign" data-toggle="modal"
        data-target="#campaign-modal" class="btn btn-outline-dark">
    </p>
  </form>
  <form style="display: none;" action="/action" id="create-action-form" method="POST">
    <div class="form-group">
      <p>
        <input type="text" class="form-control" placeholder="{{gettext('Nombre de la acción')}}" name="name"
          required></input>
      </p>
    </div>
    <div class="form-group">
      <p>
        <input type="text" class="form-control" placeholder="{{gettext('Descripción')}}" name="description"
          required></input>
      </p>
    </div>
    <div class="form-group">
      <p>
        <input type="number" step="0.01" placeholder="{{gettext('Recompensa por KPI (en UDC)')}}" class="form-control"
          name="reward" required></input>
      </p>
    </div>
    <div class="form-group">
      <p>
        <select class="form-control" name="campaign">
          <option disabled selected>{{gettext('Campaña')}}</option>
          {% for c in campaigns %}
          <option value='{{c.id}}'>{{c.name}}</option>
          {% endfor %}
        </select>
      </p>
    </div>
    <div class="form-group">
      <p>
        <input type="text" class="form-control" placeholder="{{gettext('Indicador de KPI')}}" name="kpi"
          required></input>
      </p>
    </div>
    <div class="form-group">
      <p>
        <input type="number" step="0.01" placeholder="{{gettext('Objetivo')}}" class="form-control" name="target"
          required></input>
      </p>
    </div>
    <div class="form-group">
      <input type="button" name="create_action" value="{{gettext('Crear acción')}}" data-toggle="modal"
        data-target="#action-modal" class="btn btn-outline-dark">
    </div>
  </form>
  <form style="display: none;" id="create-offer-form" method="POST">
    {{ form2.csrf_token }}
    <div class="form-group">
      <p>
        <label for="offer_name">{{gettext('Nombre de la oferta')}}</label>

        <br />
        {{form2.offer_name(class="form-control")}}
      </p>
    </div>
    {% if user.role == "Administrador" %}
    <div class="form-group">
      {{gettext('Organización')}}
      <br />
      {{form2.company(class="form-control")}}
    </div>
    {% endif %}
    <div class="form-group">
      {{gettext('Descripción')}}
      <br />
      {{form2.description(class="form-control")}}
    </div>
    <div class="form-group">
      {{gettext('Precio')}}
      <br />
      {{form2.price(class="form-control")}}
    </div>
    <p>
      <input type="button" name="create_offer" value="Create offer" data-toggle="modal" data-target="#offer-modal"
        class="btn btn-outline-dark">
    </p>
  </form>
</div>
<div id="acciones" style="display: none;">
  {% if actions|length >= 1 %}
  <p style="font-size:75%;" class="showDetails"><b>{{gettext('Gire la pantalla para más detalles.')}}</b></p>
  <table class="table" id="acciones" style="table-layout:auto; font-size:70%;">
    <thead>
      <tr>
        <th scope="col" class="nom">{{gettext('Nombre')}}</th>
        <th scope="col" class="emp">{{gettext('Empresa')}}</th>
        <th scope="col" class="des">{{gettext('Descripción')}}</th>
        <th scope="col" class="rec">{{gettext('Recompensa por KPI')}}</th>
        <th scope="col" class="ind">{{gettext('Indicador')}}</th>
        <th scope="col" class="est">{{gettext('Estado actual')}}</th>
        <th scope="col" class="obj">{{gettext('Objetivo')}}</th>
        <th scope="col" class="qr">{{gettext('Código QR')}}</th>
      </tr>
    </thead>
    <tbody>
      {% for a in actions %}
      <tr>
        <th scope="row" class="nom">{{a.name}}</th>
        <td class="emp">{{a.company}}</td>
        <td class="des">{{a.description}}</td>
        <td class="rec">{{a.reward}} UDC</td>
        <td class="ind">{{a.kpi_indicator}}</td>
        <td class="est">{{a.kpi}}</td>
        <td class="obj">{{a.kpi_target}}</td>
        <td><a href="{{ url_for('qr' ,action_id=a.id) }}" target="_blank" class="qr"><b>{{gettext('Descargar')}}</b></a>
        </td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
  {% else %}
  <h4>{{gettext('No hay acciones para mostrar')}}</h4>
  {% endif %}
</div>
<div id="campanyas" style="display: none;">
  {% if campaigns|length >= 1 %}
  <table class="table" style="table-layout:fixed; font-size:70%;">
    <thead>
      <tr>
        <th scope="col">{{gettext('Nombre')}}</th>
        <th scope="col">{{gettext('Empresa')}}</th>
        <th scope="col">{{gettext('Descripción')}}</th>
      </tr>
    </thead>
    <tbody>
      {% for c in campaigns %}
      <tr>
        <th scope="row">{{c.name}}</th>
        <td>{{c.company}}</td>
        <td>{{c.description}}</td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
  {% else %}
  <h4>{{gettext('No hay campañas para mostrar')}}</h4>
  {% endif %}
</div>
<div id="ofertas" style="display: none;">
  {% if offers|length >= 1 %}
  <table class="table" style="table-layout:fixed; font-size:70%;">
    <thead>
      <tr>
        <th scope="col">{{gettext('Nombre')}}</th>
        <th scope="col">{{gettext('Empresa')}}</th>
        <th scope="col">{{gettext('Descripción')}}</th>
        <th scope="col">{{gettext('Precio')}}</th>
        <th scope="col">{{gettext('Código QR')}}</th>
      </tr>
    </thead>
    <tbody>
      {% for o in offers %}
      <tr>
        <th scope="row">{{o.name}}</th>
        <td>{{o.company}}</td>
        <td>{{o.description}}</td>
        <td>{{o.price}} UDC</td>
        <td><a href="{{ url_for('qr_offers' ,offer_id=o.id) }}" target="_blank"><b>{{gettext('Descargar')}}</b></a></td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
  {% else %}
  <h4>{{gettext('No hay ofertas para mostrar')}}</h4>
  {% endif %}
</div>

<div class="modal fade" id="action-modal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel"
  aria-hidden="true">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="exampleModalLabel">Confirm action</h5>
        <button class="close" type="button" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">×</span>
        </button>
      </div>
      <div class="modal-body">Do you want to create a new good deed?</div>
      <div class="modal-footer">
        <button class="btn btn-secondary" type="button" data-dismiss="modal">Cancel</button>
        <a class="btn btn-primary" id="action-submit" href="/action">Create</a>
      </div>
    </div>
  </div>
</div>

<div class="modal fade" id="campaign-modal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel"
  aria-hidden="true">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="exampleModalLabel">Confirm action</h5>
        <button class="close" type="button" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">×</span>
        </button>
      </div>
      <div class="modal-body">Do you want to create a new campaign?</div>
      <div class="modal-footer">
        <button class="btn btn-secondary" type="button" data-dismiss="modal">Cancel</button>
        <a class="btn btn-primary" id="campaign-submit" href="/action">Create</a>
      </div>
    </div>
  </div>
</div>

<div class="modal fade" id="offer-modal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel"
  aria-hidden="true">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="exampleModalLabel">Confirm action</h5>
        <button class="close" type="button" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">×</span>
        </button>
      </div>
      <div class="modal-body">Do you want to create a new offer?</div>
      <div class="modal-footer">
        <button class="btn btn-secondary" type="button" data-dismiss="modal">Cancel</button>
        <a class="btn btn-primary" id="offer-submit" href="/action">Create</a>
      </div>
    </div>
  </div>
</div>
<script>
  $('#action-submit').click(function (e) {
    e.preventDefault();
    let input = $('<input>')
      .attr("type", "hidden")
      .attr('name', 'create_action');
    $('#create-action-form').append(input);
    $('#create-action-form').submit();
  });
</script>
<script>
  $('#campaign-submit').click(function (e) {
    e.preventDefault();
    let input = $('<input>')
      .attr("type", "hidden")
      .attr('name', 'create_campaign');
    $('#create-campaign-form').append(input);
    $('#create-campaign-form').submit();
  })
</script>
<script>
  $('#offer-submit').click(function (e) {
    e.preventDefault();
    let input = $('<input>')
      .attr("type", "hidden")
      .attr('name', 'create_offer');
    $('#create-offer-form').append(input);
    $('#create-offer-form').submit();
  })
</script>
<script>
  $(document).ready(function () {
    $("#mostrarformcamp").click(function () {
      $("#create-campaign-form").show();
      $("#acciones").hide();
      $("#campanyas").hide();
      $("#create-action-form").hide();
      $("#ofertas").hide();
      $("#create-offer-form").hide();
    });
  });
</script>
<script>
  $(document).ready(function () {
    $("#mostrarcamp").click(function () {
      $("#create-campaign-form").hide();
      $("#acciones").hide();
      $("#campanyas").show();
      $("#create-action-form").hide();
      $("#ofertas").hide();
      $("#create-offer-form").hide();
    });
  });
</script>
<script>
  $(document).ready(function () {
    $("#mostrarformacc").click(function () {
      $("#create-action-form").show();
      $("#campanyas").hide();
      $("#create-campaign-form").hide();
      $("#acciones").hide();
      $("#ofertas").hide();
      $("#create-offer-form").hide();
    });
  });
</script>
<script>
  $(document).ready(function () {
    $("#mostraracc").click(function () {
      $("#create-action-form").hide();
      $("#campanyas").hide();
      $("#create-campaign-form").hide();
      $("#acciones").show();
      $("#ofertas").hide();
      $("#create-offer-form").hide();
    });
  });
</script>
<script>
  $(document).ready(function () {
    $("#mostrarofertas").click(function () {
      $("#create-action-form").hide();
      $("#campanyas").hide();
      $("#create-campaign-form").hide();
      $("#acciones").hide();
      $("#ofertas").show();
      $("#create-offer-form").hide();
    });
  });
</script>
<script>
  $(document).ready(function () {
    $("#crearofertas").click(function () {
      $("#create-action-form").hide();
      $("#campanyas").hide();
      $("#create-campaign-form").hide();
      $("#acciones").hide();
      $("#ofertas").hide();
      $("#create-offer-form").show();
    });
  });
</script>
{% endblock %}